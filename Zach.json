{
  "name": "Zach from Priority Roofing",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes",
              "minutesInterval": 3
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        0,
        0
      ],
      "id": "d613489e-08de-4b71-bd28-dcc363aff096",
      "name": "Schedule Trigger"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "2821f87d-0df0-4ad8-819e-038af9852998",
              "name": "ID",
              "value": "={{ $json.id }}",
              "type": "string"
            },
            {
              "id": "e26e65ff-570d-4a1e-9e0d-72cda2d573e3",
              "name": "First Name",
              "value": "={{ $json['First Name'] }}",
              "type": "string"
            },
            {
              "id": "35f68617-b775-47da-8ebb-5b094ab81cc1",
              "name": "Mobile",
              "value": "={{ $json['Phone Number'] }}",
              "type": "string"
            },
            {
              "id": "cb54ad4f-1479-4569-b0e9-5c61dd50c82c",
              "name": "Address",
              "value": "={{ $json['Property Address'] }}",
              "type": "string"
            },
            {
              "id": "1fcc4dba-e953-407d-821d-a589632135c0",
              "name": "Office Type",
              "value": "={{ $json['Property Type'] }}",
              "type": "string"
            },
            {
              "id": "64d54b71-92d4-4db2-8da5-ee4a769db604",
              "name": "Extra Info",
              "value": "={{ $json['Property Info'] }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        660,
        0
      ],
      "id": "812dd952-04e0-4b3c-a7df-0ab51aa799ef",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "operation": "search",
        "base": {
          "__rl": true,
          "value": "appE5y13csfXlZpzx",
          "mode": "list",
          "cachedResultName": "Free Inspection Booking",
          "cachedResultUrl": "https://airtable.com/appE5y13csfXlZpzx"
        },
        "table": {
          "__rl": true,
          "value": "tbla2fmK5ZTEYEcuo",
          "mode": "list",
          "cachedResultName": "Leads",
          "cachedResultUrl": "https://airtable.com/appE5y13csfXlZpzx/tbla2fmK5ZTEYEcuo"
        },
        "filterByFormula": "({Status} = 'TBC')",
        "options": {}
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        220,
        0
      ],
      "id": "b9852174-2634-4abf-a09c-049b746c2c71",
      "name": "Airtable",
      "credentials": {
        "airtableTokenApi": {
          "id": "yGjpocFdI8wQrhte",
          "name": "Foluke-Levi Airtable"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.vapi.ai/call",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer 227285d3-37cc-4386-bccc-1f40b45dfd21"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"assistantId\": \"99c000cd-ce5b-4b1c-b826-be300fd8a78e\",\n  \"assistantOverrides\": {\n    \"variableValues\": {\n      \"id\": \"{{ $json.ID }}\",\n      \"name\": \"{{ $json['First Name'] }}\",\n      \"phoneNumber\": \"{{ $json.Mobile }}\",\n      \"address\": \"{{ $json.Address }}\",\n      \"officeType\": \"{{ $json['Office Type'] }}\",\n      \"extraInfo\": \"{{ $json['Extra Info'] }}\"\n    }\n  },\n  \"customer\": {\n    \"number\": \"{{ $json.Mobile }}\"\n  },\n  \"phoneNumberId\": \"a2fd86fa-eb02-4e3d-bb02-fdb8c9075ae4\"\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        880,
        0
      ],
      "id": "3f5e375d-0955-462e-aa4e-41905e032d8a",
      "name": "Trigger VAPI Call"
    },
    {
      "parameters": {
        "operation": "update",
        "base": {
          "__rl": true,
          "value": "appE5y13csfXlZpzx",
          "mode": "list",
          "cachedResultName": "Free Inspection Booking",
          "cachedResultUrl": "https://airtable.com/appE5y13csfXlZpzx"
        },
        "table": {
          "__rl": true,
          "value": "tbla2fmK5ZTEYEcuo",
          "mode": "list",
          "cachedResultName": "Leads",
          "cachedResultUrl": "https://airtable.com/appE5y13csfXlZpzx/tbla2fmK5ZTEYEcuo"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $('Edit Fields').item.json.ID }}",
            "Status": "In-Progress",
            "ID": "={{ $('Edit Fields').item.json.ID }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true
            },
            {
              "id": "ID",
              "displayName": "ID",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "First Name",
              "displayName": "First Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Phone Number",
              "displayName": "Phone Number",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Property Address",
              "displayName": "Property Address",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Property Type",
              "displayName": "Property Type",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Property Info",
              "displayName": "Property Info",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "options",
              "options": [
                {
                  "name": "In-Progress",
                  "value": "In-Progress"
                },
                {
                  "name": "Failed",
                  "value": "Failed"
                },
                {
                  "name": "Called",
                  "value": "Called"
                },
                {
                  "name": "Voicemail",
                  "value": "Voicemail"
                },
                {
                  "name": "TBC",
                  "value": "TBC"
                }
              ],
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Outcome",
              "displayName": "Outcome",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "options",
              "options": [
                {
                  "name": "Appointment Booked",
                  "value": "Appointment Booked"
                },
                {
                  "name": "No Appointment",
                  "value": "No Appointment"
                }
              ],
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Inspection Date",
              "displayName": "Inspection Date",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "dateTime",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Attempt",
              "displayName": "Attempt",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "options",
              "options": [
                {
                  "name": "#1",
                  "value": "#1"
                },
                {
                  "name": "#2",
                  "value": "#2"
                },
                {
                  "name": "#3",
                  "value": "#3"
                },
                {
                  "name": "Unreachable",
                  "value": "Unreachable"
                },
                {
                  "name": "#Success",
                  "value": "#Success"
                }
              ],
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Summary",
              "displayName": "Summary",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Transcript",
              "displayName": "Transcript",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Assignee",
              "displayName": "Assignee",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Last Hope",
              "displayName": "Last Hope",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        1100,
        0
      ],
      "id": "6d2c8ace-512b-4bfe-b7c0-728e23a93c34",
      "name": "Update Lead Record",
      "credentials": {
        "airtableTokenApi": {
          "id": "yGjpocFdI8wQrhte",
          "name": "Foluke-Levi Airtable"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        440,
        0
      ],
      "id": "40e6a9b1-70fe-4619-a093-efc067213aeb",
      "name": "Limit"
    },
    {
      "parameters": {
        "resource": "calendar",
        "calendar": {
          "__rl": true,
          "value": "3524b2651ff1eb066c21a939d88b39b2ea9e82dd09b001011fa1c97ad3ab6dd4@group.calendar.google.com",
          "mode": "list",
          "cachedResultName": "Inspection Appointments"
        },
        "timeMin": "={{ $fromAI('Start_Time', `start time of the booking in ISO 8601 format WITHOUT timezone offset, e.g., 2025-04-12T15:00:00`, 'string') + '-05:00' }}",
        "timeMax": "={{ $fromAI('End_Time', `end time of the booking in ISO 8601 format WITHOUT timezone offset, e.g., 2025-04-12T16:00:00`, 'string') + '-05:00' }}",
        "options": {}
      },
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.3,
      "position": [
        900,
        630
      ],
      "id": "5ce0011d-16dc-40dd-b0b5-23b59e7de83c",
      "name": "Availability Tool",
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "w6RmgsUVZuLY0TCM",
          "name": "Google Calendar account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json['Booking Info'].Date }} --> This is the requested booking date. ",
        "options": {
          "systemMessage": "=The current date is {{ $now }}.\n\nYou are a scheduling assistant. Your job is to check if the user's requested date and time is available using the Availability Tool.\n\n---\n\nüîß Step 1: Use the **Availability Tool**\n- Call the Availability Tool using the `Start_Time` and `End_Time` values extracted from the user's request.\n- The slot is **assumed to be 1 hour** unless stated otherwise.\n- The tool will return any conflicting calendar events that overlap with the requested time window.\n\n---\n\nüìã Step 2: Interpret the Result\n- If the tool returns **one or more events**, the time is **booked**.\n  - Then, suggest 3 alternative 1-hour time slots on the same day, between 9 AM and 5 PM.\n  - Format your response as:\n    ```\n    Unavailable at requested time. Suggested alternatives: [10:00 AM, 2:00 PM, 3:30 PM]\n    ```\n- If the tool returns **no events**, respond with:\n    ```\n    Available\n    ```\n\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.8,
      "position": [
        692,
        410
      ],
      "id": "3072f032-fdb4-4ae8-b22d-6ec07dcaab29",
      "name": "Check Availability",
      "retryOnFail": true
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-3.5-turbo",
          "mode": "list",
          "cachedResultName": "gpt-3.5-turbo"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        660,
        630
      ],
      "id": "759121bc-e23e-4d91-b1c0-d1fc12cdfede",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "lwnvKDh7b8Veic38",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "24f312a6-6332-4af0-b540-46f651a63de4",
              "leftValue": "={{ $json.Result }}",
              "rightValue": "Available",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "f6ffff4e-61da-4287-837a-e58a65b834b9",
              "leftValue": "={{ $json.Result }}",
              "rightValue": "Output: Available",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1540,
        510
      ],
      "id": "4b4c1cfc-2b3b-4a3d-9ab5-e3ec9662e162",
      "name": "If1"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        1760,
        480
      ],
      "id": "2b3011e3-cddb-4d94-a463-132c229312e7",
      "name": "OpenAI Chat Model1",
      "credentials": {
        "openAiApi": {
          "id": "lwnvKDh7b8Veic38",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=This is the booking info:\n\n{{ $('Edit Fields1').item.json['Booking Info'].ID }}\nRequested Date: {{ $('Edit Fields1').item.json['Booking Info'].Date }}\nCustomer Name: {{ $('Edit Fields1').item.json['Booking Info'].Name }}\nCustomer Address: {{ $('Edit Fields1').item.json['Booking Info'].Address }}",
        "options": {
          "systemMessage": "=The current date is: {{ $now }}\n\n---\n\n### üéØ Task: Handle Customer Booking Request\n\nYou are a scheduling assistant. Complete the steps **in order**, invoking **only one tool per iteration**. Wait for a tool's response **before proceeding to the next step**.\n\n‚ùó Never invoke the same tool more than once per booking flow.  \n‚ùó Stop immediately if any tool fails or returns unexpected output.\n\n---\n\n#### 1. Extract Booking Details  \nFrom the user message, extract:\n- Customer‚Äôs **Name**  \n- Customer‚Äôs **ID** (format: `rec...`)  \n- Requested **Booking Date** (format: \"2025-04-12T15:00:00\")  \n\n---\n\n#### 2. Retrieve Customer Info  \n- Use the **Get Airtable Record** tool  \n- Match using the **Customer ID**  \n- Retrieve:  \n  - Phone Number  \n  - Address  \n\n---\n\n#### 3. Create the Booking (Book Appointment)  \n- Use the **Book Appointment** tool with:\n  - `Start_Time` and `End_Time` from the customer's confirmed time\n  - `Description` and `Summary` as:  \n    ```\n    Free Inspection for [Customer Name] at [Address]\n    ```\n\n‚úÖ Proceed only if the tool returns:  \n  - `\"status\": \"confirmed\"`  \n  - A valid `\"id\"`  \n  - A valid `start.dateTime` value  \n\n‚úîÔ∏è Store values if successful:\n- `Booking_Confirmed = true`  \n- `Confirmed_Time = start.dateTime`\n\n‚ùå If not, stop and return:  \n```\nError in step 4: Booking failed or incomplete calendar response.\n```\n\n---\n\n#### 4. [Optional] Send SMS Confirmation  \n- If `Booking_Confirmed = true`, use the **Twilio** tool to send:  \n```\nHi, [Customer Name]. Your free roofing inspection with Levi from Priority Roofing has been booked successfully for [Date] [Time]. I look forward to checking in on your roof and ensuring it is well protected for the long term.\n```\n\n‚úÖ If SMS fails or Twilio is disabled, skip and continue.\n\n---\n\n#### 5. Update Airtable Record  \n- Use the **Update Airtable Record** tool  \n- Match using the **Customer ID**  \n- Update:\n  - `Status`: `\"Called\"`  \n  - `Outcome`: `\"Appointment Booked\"`  \n  - `Inspection Date`: `Confirmed_Time` (in ISO 8601 UTC format)  \n  - `Attempt`: `\"#1\"`  \n\n‚ùó Do not use hardcoded times. Only use the calendar-confirmed time.\n\n---\n\n### ‚úÖ FINAL INSTRUCTION  \nIf all steps succeed, return only:\n```\nI have successfully created the booking for [Customer Name] at [Time] on [Date] for the Free Inspection. Looking forward to seeing you soon!\n```\n\n---\n\n### üßØ Error Handling  \nIf any tool fails, returns empty, or has missing/invalid data:  \nStop and return:  \n```\nError in step [Step Number]: [Brief Description]\n```\n\nDo not retry any tools unless explicitly instructed.\n",
          "maxIterations": 5,
          "returnIntermediateSteps": true
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.8,
      "position": [
        1972,
        260
      ],
      "id": "34307aec-4dae-416f-ad24-3d7e8cc0c64b",
      "name": "Create Booking",
      "retryOnFail": false
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "a9db41e4-847a-41a2-8d72-9ebd88e9924b",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        0,
        910
      ],
      "id": "1d84c14f-883a-4148-9fd8-f36f90b8c4a1",
      "name": "bookAppointment",
      "webhookId": "a9db41e4-847a-41a2-8d72-9ebd88e9924b"
    },
    {
      "parameters": {
        "from": "+19034855387",
        "to": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('To', `Customer Phone Number`, 'string') }}",
        "toWhatsapp": "",
        "message": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Message', `Hi, [Customer Name]. Your free roofing inspection with Levi from Priority Roofing has been booked successfully for [Date] [Time]. I look forward to checking in on your roof and ensuring it is well protected for the long term.`, 'string') }}",
        "options": {}
      },
      "type": "n8n-nodes-base.twilioTool",
      "typeVersion": 1,
      "position": [
        2000,
        480
      ],
      "id": "4adc576c-8794-4482-9cf0-5a161b2aa664",
      "name": "Twilio",
      "disabled": true
    },
    {
      "parameters": {
        "operation": "search",
        "base": {
          "__rl": true,
          "value": "appE5y13csfXlZpzx",
          "mode": "list",
          "cachedResultName": "Free Inspection Booking",
          "cachedResultUrl": "https://airtable.com/appE5y13csfXlZpzx"
        },
        "table": {
          "__rl": true,
          "value": "tbla2fmK5ZTEYEcuo",
          "mode": "list",
          "cachedResultName": "Leads",
          "cachedResultUrl": "https://airtable.com/appE5y13csfXlZpzx/tbla2fmK5ZTEYEcuo"
        },
        "filterByFormula": "={{ $fromAI('Filter_By_Customer_ID', `only the 'rec...' part`, 'string') }}",
        "options": {}
      },
      "type": "n8n-nodes-base.airtableTool",
      "typeVersion": 2.1,
      "position": [
        2120,
        480
      ],
      "id": "f1b4fedb-e77a-4070-b472-4bbaa01d7df5",
      "name": "Get Airtable Record",
      "credentials": {
        "airtableTokenApi": {
          "id": "yGjpocFdI8wQrhte",
          "name": "Foluke-Levi Airtable"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "base": {
          "__rl": true,
          "value": "appE5y13csfXlZpzx",
          "mode": "list",
          "cachedResultName": "Free Inspection Booking",
          "cachedResultUrl": "https://airtable.com/appE5y13csfXlZpzx"
        },
        "table": {
          "__rl": true,
          "value": "tbla2fmK5ZTEYEcuo",
          "mode": "list",
          "cachedResultName": "Leads",
          "cachedResultUrl": "https://airtable.com/appE5y13csfXlZpzx/tbla2fmK5ZTEYEcuo"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('id__using_to_match_', `This is the Customer ID to use to match.`, 'string') }}",
            "Status": "Called",
            "Outcome": "Appointment Booked",
            "Inspection Date": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Inspection_Date', `This is the Inspection Date and time booked for the Customer in CDT (e.g., 2025-04-12T10:00:00-05:00). Airtable will store it in UTC (e.g., 2025-04-12T15:00:00Z).`, 'string') }}",
            "Attempt": "#1"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true
            },
            {
              "id": "ID",
              "displayName": "ID",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "First Name",
              "displayName": "First Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Phone Number",
              "displayName": "Phone Number",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Property Address",
              "displayName": "Property Address",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Property Type",
              "displayName": "Property Type",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Property Info",
              "displayName": "Property Info",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "options",
              "options": [
                {
                  "name": "In-Progress",
                  "value": "In-Progress"
                },
                {
                  "name": "Failed",
                  "value": "Failed"
                },
                {
                  "name": "Called",
                  "value": "Called"
                },
                {
                  "name": "Voicemail",
                  "value": "Voicemail"
                },
                {
                  "name": "TBC",
                  "value": "TBC"
                },
                {
                  "name": "t",
                  "value": "t"
                }
              ],
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Outcome",
              "displayName": "Outcome",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "options",
              "options": [
                {
                  "name": "Appointment Booked",
                  "value": "Appointment Booked"
                },
                {
                  "name": "No Appointment",
                  "value": "No Appointment"
                }
              ],
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Inspection Date",
              "displayName": "Inspection Date",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "dateTime",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Attempt",
              "displayName": "Attempt",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "options",
              "options": [
                {
                  "name": "#1",
                  "value": "#1"
                },
                {
                  "name": "#2",
                  "value": "#2"
                },
                {
                  "name": "#3",
                  "value": "#3"
                },
                {
                  "name": "Unreachable",
                  "value": "Unreachable"
                },
                {
                  "name": "#Success",
                  "value": "#Success"
                }
              ],
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Summary",
              "displayName": "Summary",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Assignee",
              "displayName": "Assignee",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Last Hope",
              "displayName": "Last Hope",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.airtableTool",
      "typeVersion": 2.1,
      "position": [
        2240,
        480
      ],
      "id": "cfa25946-b292-48e3-829b-07801adb05f0",
      "name": "Update Airtable Record",
      "credentials": {
        "airtableTokenApi": {
          "id": "yGjpocFdI8wQrhte",
          "name": "Foluke-Levi Airtable"
        }
      }
    },
    {
      "parameters": {
        "calendar": {
          "__rl": true,
          "value": "3524b2651ff1eb066c21a939d88b39b2ea9e82dd09b001011fa1c97ad3ab6dd4@group.calendar.google.com",
          "mode": "list",
          "cachedResultName": "Inspection Appointments"
        },
        "start": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start', `Start time of the booking in ISO 8601 format WITHOUT timezone offset, e.g., 2025-04-12T15:00:00`, 'string') }}",
        "end": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('End', `End time of the booking in ISO 8601 format WITHOUT timezone offset, e.g., 2025-04-12T16:00:00`, 'string') }}",
        "useDefaultReminders": false,
        "additionalFields": {
          "description": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Description', ``, 'string') }}",
          "summary": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Summary', `This is the title of the event eg 'Inspection Appointment for [Customer Name]'`, 'string') }}"
        }
      },
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.3,
      "position": [
        2360,
        480
      ],
      "id": "656f0b81-a68f-443e-b94b-fb847d81144e",
      "name": "Book Appointment",
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "w6RmgsUVZuLY0TCM",
          "name": "Google Calendar account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.message.type }}",
                    "rightValue": "tool-calls",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "5fddf336-4da9-44ef-bd91-f5754c0f4381"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "952cb9c5-0653-45c7-bba0-f61c07275af8",
                    "leftValue": "={{ $json.body.message.type }}",
                    "rightValue": "end-of-call-report",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "8be73fbe-a07e-4381-a169-f6e1d187b2dd",
                    "leftValue": "={{ $json.body.message.endedReason }}",
                    "rightValue": "customer-did-not-answer",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        220,
        910
      ],
      "id": "26f4aaa3-20e5-4daf-abdd-000fe12ad0b9",
      "name": "Switch"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={\n   \"results\": [\n      {\n         \"toolCallId\": \"{{ $('bookAppointment').item.json.body.message.toolCalls[0].id}}\",\n         \"result\": \"{{ $json.output }}\"\n      }\n   ]\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        2560,
        360
      ],
      "id": "d5d98bc4-815b-4c98-ac79-cff524c17699",
      "name": "Respond to Webhook"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={\n   \"results\": [\n      {\n         \"toolCallId\": \"{{ $('bookAppointment').item.json.body.message.toolCalls[0].id}}\",\n         \"result\": \"{{ $('Store Availability Result').item.json.Result }}\"\n      }\n   ]\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        2050,
        660
      ],
